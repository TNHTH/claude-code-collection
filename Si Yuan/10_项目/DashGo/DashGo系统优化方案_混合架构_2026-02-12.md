---
title: 通用轮式机器人导航训练框架 (v5.0)
created: 2026-02-13 00:34:42
tags: [DashGo, Leap1, 导航框架, PPO, IMPALA-CNN, MPPI, Isaac Sim, Sim2Real, 模块化]
---

# 通用轮式机器人导航训练框架 (v5.0 - Modular & Transferable)

> **定位**: 模块化、可迁移的 DRL 导航训练方案。首发平台 DashGo D1 / Leap1，可零改动迁移至 TurtleBot、阿克曼车等。
> **设计原则**: 兼顾智能与效率，追求高帧率推理（>20Hz），支持从 PC 到嵌入式的全平台部署。

---

## 一、 需求剖析 (First Principles)

### 1.1 核心矛盾

```
我们要解决的根本问题：
  让一个低成本差速小车，在未知动态环境中，
  仅凭一个 2D 激光雷达，实现安全、平滑、快速的自主导航。

约束条件：
  ① 传感器简陋（单线雷达，360°，720点，6Hz）
  ② 算力弹性（PC开发 → 未来可能边缘部署）
  ③ 跨平台迁移（DashGo → Leap1 → TurtleBot → 阿克曼）
  ④ 控制频率 ≥ 20Hz
```

### 1.2 当前平台参数 (Ground Truth)

| 参数 | DashGo D1 | Leap1 |
| :--- | :--- | :--- |
| **底盘** | 两轮差速 | 两轮差速 (微型) |
| **轮径** | 63.2mm | 32mm |
| **轮距** | 342mm | ~150mm (需实测) |
| **质量** | 3.5kg | ~0.5kg |
| **雷达** | EAI F4, 360°, 720点 | EAI F4 (同型) |
| **最大线速度** | 0.3 m/s (安全) / 0.8 m/s (极限) | 0.2 m/s (建议) |
| **最大角速度** | 1.0 rad/s (安全) / 1.5 rad/s (极限) | ~1.5 rad/s |
| **控制频率** | 20Hz | 20Hz |
| **计算平台** | Jetson Nano 4GB | ESP32 + PC上位机 |
| **ROS** | ROS Noetic | ROS 2 Humble |

---

## 二、 模块化系统架构

### 2.1 三层解耦架构

```
┌─────────────────────────────────────────────────────────────┐
│                    感知模块 (Perception)                      │
│  ┌──────────────────────┐  ┌─────────────────────────────┐  │
│  │ 模式 A: LiDAR-Vector │  │ 模式 B: Costmap-Image       │  │
│  │ 72点归一化 + 状态向量 │  │ 84x84 局部代价地图 + 状态   │  │
│  │ 输出: 1D向量 (dim≤80)│  │ 输出: 2D图像 (2x84x84)     │  │
│  │ 速度: 极快           │  │ 速度: 快                    │  │
│  └──────────┬───────────┘  └──────────────┬──────────────┘  │
│             │ (可插拔切换)                  │                 │
├─────────────┼──────────────────────────────┼─────────────────┤
│             ▼           决策模块 (Policy)   ▼                 │
│  ┌──────────────────────┐  ┌─────────────────────────────┐  │
│  │ 模式 A: MLP          │  │ 模式 B: IMPALA-CNN + MLP    │  │
│  │ 3层FC (256-256-128)  │  │ 3个ResBlock {16,32,32}     │  │
│  │ 参数量: ~200K        │  │ 参数量: ~2.5M              │  │
│  │ 推理: <0.5ms         │  │ 推理: ~3ms                 │  │
│  └──────────┬───────────┘  └──────────────┬──────────────┘  │
│             │                              │                 │
│             ▼        归一化动作输出          ▼                 │
│          action = [v_norm, w_norm] ∈ [-1, 1]                │
├─────────────────────────────────────────────────────────────┤
│                    执行模块 (Actuator)                        │
│  ┌─────────────────────────────────────────────────────────┐│
│  │ 平台适配层 (Platform Adapter)                            ││
│  │                                                         ││
│  │ v_real = sigmoid(v_norm) × v_max    # v_max 按平台配置  ││
│  │ w_real = tanh(w_norm) × w_max       # w_max 按平台配置  ││
│  │                                                         ││
│  │ 平台参数表:                                              ││
│  │   DashGo: v_max=0.3, w_max=1.0                         ││
│  │   Leap1:  v_max=0.2, w_max=1.5                         ││
│  │   TurtleBot3: v_max=0.22, w_max=2.84                   ││
│  │   阿克曼: v_max=1.0, w_max=f(转向角, 轴距)              ││
│  └─────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────┘
```

### 2.2 为什么是两种模式？

| | 模式 A: LiDAR-MLP | 模式 B: Costmap-IMPALA |
| :--- | :--- | :--- |
| **适用场景** | 简单环境、边缘部署、高帧率要求 | 复杂环境、动态障碍、PC 部署 |
| **推理速度** | >200Hz (Jetson Nano) | >60Hz (PC) / >20Hz (Nano) |
| **空间理解** | 弱（只知道"前方有东西"） | 强（理解走廊、死胡同、缝隙） |
| **迁移难度** | 极低（改参数即可） | 低（改 Costmap 参数即可） |
| **当前项目** | DashGo v3.1 已验证 | 本次升级目标 |

**推荐策略**：先用模式 A 快速跑通全流程，验证 Sim2Real。再升级到模式 B 提升智能上限。

---

## 三、 核心技术选型 (Tech Stack)

### 3.1 感知层详细设计

#### 模式 A: LiDAR-Vector (沿用现有方案，已验证)

```python
observation_space = {
    # LiDAR (归一化到 [0,1])
    "lidar": Box(0, 1, shape=(k * n_beams,)),  # k=3帧, n=72点, dim=216

    # 机器人状态 (归一化)
    "goal_polar": Box(shape=(2,)),        # [距离/max_range, 角度/π]
    "velocity": Box(shape=(2,)),          # [v/v_max, w/w_max]
    "heading_error": Box(shape=(1,)),     # 朝向偏差/π
}
# 总维度: 216 + 5 = 221 (或按现有 246 维保持兼容)
```

#### 模式 B: Costmap-Image (升级方案)

```python
observation_space = {
    # 局部代价地图 (通过 nav2_costmap_2d 或 Isaac Sim OccupancyGrid 生成)
    "costmap": Box(0, 255, shape=(2, 84, 84), dtype=uint8),
    # Channel 0: 当前障碍物 costmap (Spatial)
    # Channel 1: 历史轨迹叠加 costmap (Temporal, 替代帧堆叠)
    # 参考: M-COST Framework (MDPI Robotics 2024)

    # 向量观测 (与 CNN 输出 concat 后进 MLP)
    "goal_polar": Box(shape=(2,)),        # [距离, 角度] 归一化
    "velocity": Box(shape=(2,)),          # [v, w] 归一化
}
```

**为什么 84x84 而不是 128x128？**
- 84x84 是 RL 社区的事实标准 (Atari/DrQ-v2)，所有 benchmark 都基于此尺寸调优。
- 覆盖范围 84×0.05m = 4.2m，足够覆盖 DashGo 的雷达有效避障距离。
- 计算量仅为 128x128 的 43%，帧率更高。

**为什么 2 通道而不是 4 帧堆叠？**
- M-COST (2024) 论文证明：2 通道 (空间+时间) 的效果 ≥ 4 帧堆叠，且计算量减半。
- 时间通道通过衰减叠加历史障碍物位置，CNN 可直接从单次前向推理中获取运动信息。

### 3.2 决策层详细设计

#### 模式 A: MLP (轻量级)

```
Input (221-dim) → FC(256, ReLU) → FC(256, ReLU) → FC(128, ReLU)
                                                        ↓
                                              ┌─────────┴──────────┐
                                              │ Actor: FC(2)       │
                                              │ Critic: FC(1)      │
                                              └────────────────────┘
参数量: ~200K
推理延迟: <0.5ms (任何平台)
```

#### 模式 B: IMPALA-CNN + MLP (高性能)

```
Costmap (2x84x84) → IMPALA-CNN → Flatten(256)
                                       ↓
                                    Concat ← FC(64) ← Vector(4-dim)
                                       ↓
                              FC(256, ReLU) → FC(256, ReLU)
                                       ↓
                             ┌─────────┴──────────┐
                             │ Actor: FC(2)       │
                             │ Critic: FC(1)      │
                             └────────────────────┘

IMPALA-CNN 结构 (DeepMind, 2018):
  Block 1: Conv(16, 3x3) → MaxPool(3x3, s2) → ResBlock(16) → ResBlock(16)
  Block 2: Conv(32, 3x3) → MaxPool(3x3, s2) → ResBlock(32) → ResBlock(32)
  Block 3: Conv(32, 3x3) → MaxPool(3x3, s2) → ResBlock(32) → ResBlock(32)
  → ReLU → Flatten → FC(256)

参数量: ~2.5M
推理延迟: ~3ms (PC GPU) / ~15ms (Jetson Nano, TensorRT)
```

**为什么 IMPALA-CNN 而不是 ResNet-18？**
- IMPALA-CNN 是 **DRL 视觉任务的事实标准** (2024-2025 论文主流选择)。
- ResNet-18 为 ImageNet 分类设计，参数量 11M，对 RL 训练来说过大且不稳定。
- IMPALA-CNN 仅 2.5M 参数，但通过残差块保持了深度网络的表达力。
- 2025 年 Impoola 论文建议用 AvgPool 替代 MaxPool 可进一步提升泛化性。

### 3.3 动作空间

```python
action_space = Box(low=[-1, -1], high=[1, 1], shape=(2,))
# action[0] → 线速度比例: v = sigmoid(a[0]) × v_max
# action[1] → 角速度比例: w = tanh(a[1]) × w_max

# 执行模块负责映射到具体平台:
platform_config = {
    "dashgo_d1": {"v_max": 0.3, "w_max": 1.0},
    "leap1":     {"v_max": 0.2, "w_max": 1.5},
    "turtlebot3": {"v_max": 0.22, "w_max": 2.84},
    "ackermann":  {"v_max": 1.0, "steering_max": 0.5},  # 阿克曼需转换
}
```

**跨平台迁移关键**：策略网络永远只输出归一化的 [-1, 1]，具体速度由执行模块按平台参数映射。换车 = 换一行配置。

### 3.4 训练算法

**选择: PPO (Proximal Policy Optimization)**

| 候选 | 样本效率 | 稳定性 | POMDP 表现 | 结论 |
| :--- | :--- | :--- | :--- | :--- |
| **PPO** | 中 | **最高** | **最好** | **首选** |
| SAC | 高 | 高 | 较差 | 备选 (复杂场景) |
| TD3 | 高 | 中 | 差 | 不推荐 |

**理由**: 机器人导航本质是 **POMDP** (传感器有盲区、有噪声)。论文实证 PPO 在 POMDP 下显著优于 SAC/TD3。

### 3.5 奖励函数设计

```python
def compute_reward(state, action, prev_action):
    r = 0.0

    # 1. 目标奖励 (绝对主导)
    if reached_goal:
        r += 200.0

    # 2. 碰撞惩罚
    if collision:
        r -= 50.0

    # 3. 进度引导 (每步)
    r += (prev_dist - curr_dist) * 5.0   # 靠近目标 +, 远离 -

    # 4. 平滑惩罚 (Sim2Real 关键!)
    action_diff = abs(action - prev_action)
    r -= action_diff.sum() * 0.1

    # 5. 超时惩罚
    r -= 0.01  # 每步微惩罚，鼓励高效

    return r
```

---

## 四、 教师数据管线 (Teacher Pipeline)

### 4.1 MPPI → DPtraj → Dataset

```
Isaac Sim 5.0
    │
    ├── 加载 DashGo URDF + 随机障碍物场景
    ├── 运行 MPPI (Nav2 Controller) 作为教师
    │     └── 输出: 粗糙但安全的 (v, w) 序列
    │
    ├── DPtraj 后处理 (ZJU-FAST-Lab)
    │     └── 输出: 平滑、符合动力学的 (v, w) 序列
    │
    └── 存储: {observation, smoothed_action} → Expert Dataset
```

### 4.2 两阶段训练

**Phase 1: 行为克隆 (BC) — 快速冷启动**
- 用 Expert Dataset 做监督学习
- Loss: MSE(predicted_action, expert_action)
- 目标: 80 分导航能力（不撞墙、能到达）

**Phase 2: PPO 微调 — 超越老师**
- 加载 BC 权重作为初始化
- 开启 Domain Randomization:
  - 摩擦系数: [0.5, 1.5]
  - 质量扰动: ±20%
  - LiDAR 噪声: Gaussian(0, 0.02m)
  - 动作延迟: 0-3 steps
- 并行环境: 1024-4096 个
- 目标: 学会动态避障、复杂地形脱困

---

## 五、 Sim-to-Real 迁移策略

### 5.1 迁移检查清单

| 技术 | 实现方式 | 重要性 |
| :--- | :--- | :--- |
| **观测归一化** | LiDAR/max_range → [0,1]；目标用极坐标 | 必须 |
| **动作归一化** | 输出 [-1,1]，底层映射到真实速度 | 必须 |
| **Domain Randomization** | 摩擦、质量、噪声、延迟 | 必须 |
| **Action Smoothing** | 奖励函数中加入动作变化惩罚 | 必须 |
| **Scenario Augmentation** | 缩放因子训练多尺度环境 (2025 新方法) | 推荐 |
| **中间验证** | Isaac Sim → Gazebo → 真实平台 | 推荐 |

### 5.2 跨平台零迁移原理

```
关键洞察 (Springer 2025 实证):
  "在 TurtleBot2 上训练的策略，可以零调整直接迁移到
   不同规格的硬件平台，持续保持稳定的避障性能。"

实现条件:
  ① 所有距离观测除以传感器最大量程 → [0, 1]
  ② 目标位置使用相对极坐标 (与机器人尺寸无关)
  ③ 动作输出为比例值 (与具体速度解耦)
  ④ Domain Randomization 覆盖目标平台的参数范围
```

### 5.3 阿克曼车型迁移方案

```
差速车: action = [v, w]
阿克曼: action = [v, steering_angle]

迁移方式:
  策略网络不变，仍输出 [v_norm, w_norm]
  执行模块做转换: steering_angle = atan(w * wheelbase / v)
  (即: 角速度 → 转向角的运动学映射)
```

---

## 六、 技术选型依据 (References)

| 技术决策 | 依据来源 |
| :--- | :--- |
| LiDAR 导航用 MLP | ICRA 2022 (Cimurs, TD3), Frontiers 2023, arXiv 2405.16266 |
| Costmap 导航用 IMPALA-CNN | Espeholt 2018 (DeepMind), arXiv 2503.05546 (Impoola, 2025) |
| 84x84 分辨率 | DrQ-v2 (Yarats 2021), RL 社区事实标准 |
| 2通道 M-COST 替代帧堆叠 | MDPI Robotics 2024 (M-COST Framework) |
| PPO 优于 SAC/TD3 (POMDP) | arXiv 2209.04999 实证对比 |
| 跨平台零迁移 | Springer 2025 (TurtleBot2 实证) |
| MPPI 教师 | Nav2 官方推荐, 非凸环境 SOTA |
| DPtraj 平滑 | Science Robotics 2025 (ZJU-FAST-Lab) |
| Scenario Augmentation | arXiv 2503.01146 (2025) |
| Isaac Lab Sim2Real | arXiv 2501.02902, Wheeled Lab (2025) |

---

## 七、 执行路线 (Roadmap)

```
Phase 0: 环境准备
  └── Isaac Sim 5.0 + Isaac Lab + DashGo URDF

Phase 1: 模式 A 快速验证 (LiDAR-MLP)
  ├── 沿用现有 72点 LiDAR 观测
  ├── MLP 策略网络
  ├── PPO 训练 (1024 envs)
  └── Sim2Real 验证 (DashGo D1)

Phase 2: 模式 B 智能升级 (Costmap-IMPALA)
  ├── 实现 84x84 M-COST 观测
  ├── IMPALA-CNN 策略网络
  ├── BC 冷启动 + PPO 微调
  └── 对比模式 A 的性能提升

Phase 3: 跨平台迁移
  ├── Leap1 迁移 (改执行模块参数)
  ├── TurtleBot3 迁移 (Gazebo 验证)
  └── 阿克曼车型迁移 (运动学转换)
```
